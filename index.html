<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REGISTRO DE PEDIDOS ACTECK</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #000;
            color: white;
            text-align: center;
            padding: 20px;
            text-transform: uppercase;
        }
        h1 {
            margin-bottom: 20px;
        }
        .opciones {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .registro-form {
            display: none;
            max-width: 600px;
            margin: 0 auto;
            text-align: left;
            padding: 20px;
            border: 1px solid #555;
            background-color: #222;
        }
        .registro-form.active {
            display: block;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: white;
        }
        input, textarea, select {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            background-color: #333;
            color: white;
            border: none;
        }
        button {
            padding: 8px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
            text-transform: uppercase;
        }
        button.cancelar {
            background-color: #f44336;
        }
        button:hover {
            background-color: #45a049;
        }
        .message {
            color: #4CAF50;
            margin-top: 10px;
        }
        .registros {
            max-width: 600px;
            margin: 20px auto;
            text-align: left;
            padding: 20px;
            border: 1px solid #555;
            background-color: #333;
            display: none;
        }
        .registros.active {
            display: block;
        }
        .registro {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #555;
        }
        .registro.entrega {
            background-color: blue; /* Color azul para registros de entrega */
        }
        .registro.finalizado {
            background-color: green; /* Color verde para registros finalizados */
        }
        #reloj-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }
        #reloj {
            font-size: 20px;
        }
        #filtroFechaContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        #filtroFechaContainer label {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div id="reloj-container">
        <div id="reloj"></div>
    </div>
    <h1>REGISTRO DE PEDIDOS ACTECK</h1>

    <div class="opciones">
        <button onclick="mostrarFormulario('entrega')">SURTIDO</button>
        <button onclick="mostrarFormulario('finalizado')">EMPAQUE</button>
        <button onclick="mostrarTodosRegistros()">Ver Todos los Registros</button>
    </div>

    <div id="registroEntrega" class="registro-form">
        <h2>Registro de entrega de pedidos a empaque</h2>
        <form id="formEntrega">
            <label for="nombreEntrega">Usuario:</label>
            <input type="text" id="nombreEntrega" required>
            <br>
            <label for="pedidoEntrega">GDL:</label>
            <input type="text" id="pedidoEntrega" required>
            <br>
            <label for="fechaHoraImpresion">Fecha y Hora de Impresión de Documento:</label>
            <input type="datetime-local" id="fechaHoraImpresion" required>
            <br>
            <button type="button" onclick="registrarEntrega()">Registrar Entrega</button>
            <button type="button" class="cancelar" onclick="cancelarRegistro('entrega')">Cancelar</button>
        </form>
        <p id="mensajeEntrega" class="message"></p>
    </div>

    <div id="registroFinalizado" class="registro-form">
        <h2>Registro de finalizado de empaque de pedidos</h2>
        <form id="formFinalizado">
            <label for="nombreFinalizado">Usuario:</label>
            <input type="text" id="nombreFinalizado" required>
            <br>
            <label for="pedidoFinalizado">GDL:</label>
            <input type="text" id="pedidoFinalizado" required>
            <br>
            <label for="fechaHoraInicioEmpaque">Fecha y Hora de Inicio de Empaque:</label>
            <input type="datetime-local" id="fechaHoraInicioEmpaque" required>
            <br>
            <label for="estatus">Estatus:</label>
            <select id="estatus" required>
                <option value="completo">Completo</option>
                <option value="incidencia">Incidencia</option>
            </select>
            <br>
            <textarea id="observaciones" placeholder="Observaciones (si aplica)"></textarea>
            <br>
            <button type="button" onclick="registrarFinalizado()">Finalizar</button>
            <button type="button" class="cancelar" onclick="cancelarRegistro('finalizado')">Cancelar</button>
        </form>
        <p id="mensajeFinalizado" class="message"></p>
    </div>

    <div id="registros" class="registros">
        <h2>Registros Realizados</h2>
        <div id="filtroFechaContainer">
            <label for="fechaFiltro">Filtrar por Fecha:</label>
            <input type="date" id="fechaFiltro" onchange="filtrarPorFecha()">
            <button onclick="exportarRegistros()">Exportar Registros</button>
            <button onclick="volverAlPrincipal()">Volver al Principal</button>
        </div>
        <div id="listaRegistros"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script>
        function mostrarFormulario(opcion) {
            document.getElementById('registroEntrega').classList.remove('active');
            document.getElementById('registroFinalizado').classList.remove('active');
            document.getElementById('registros').classList.remove('active');

            if (opcion === 'entrega') {
                document.getElementById('registroEntrega').classList.add('active');
            } else if (opcion === 'finalizado') {
                document.getElementById('registroFinalizado').classList.add('active');
            }
        }

        function registrarEntrega() {
            const nombre = document.getElementById('nombreEntrega').value;
            const pedido = document.getElementById('pedidoEntrega').value;
            const fechaHoraImpresion = document.getElementById('fechaHoraImpresion').value;
            const timestamp = new Date();

            const registro = {
                nombre: nombre,
                pedido: pedido,
                fechaHoraImpresion: formatDateTime(new Date(fechaHoraImpresion)),
                fechaRegistro: formatDateTime(timestamp),
                tiempoTotal: calcularTiempoTotal(new Date(fechaHoraImpresion), timestamp)
            };

            // Simulación de almacenamiento local (no persistente)
            let registros = JSON.parse(localStorage.getItem('entrega')) || [];
            registros.push(registro);
            localStorage.setItem('entrega', JSON.stringify(registros));

            document.getElementById('formEntrega').reset();
            document.getElementById('mensajeEntrega').innerText = 'El registro se realizó exitosamente.';
            mostrarRegistros();
            setTimeout(() => {
                document.getElementById('mensajeEntrega').innerText = '';
                document.getElementById('registroEntrega').classList.remove('active');
            }, 3000);
        }

        function registrarFinalizado() {
            const nombre = document.getElementById('nombreFinalizado').value;
            const pedido = document.getElementById('pedidoFinalizado').value;
            const fechaHoraInicioEmpaque = document.getElementById('fechaHoraInicioEmpaque').value;
            const estatus = document.getElementById('estatus').value;
            const observaciones = document.getElementById('observaciones').value;
            const timestamp = new Date();

            const registro = {
                nombre: nombre,
                pedido: pedido,
                fechaHoraInicioEmpaque: formatDateTime(new Date(fechaHoraInicioEmpaque)),
                fechaRegistro: formatDateTime(timestamp),
                tiempoTotal: calcularTiempoTotal(new Date(fechaHoraInicioEmpaque), timestamp),
                estatus: estatus,
                observaciones: observaciones
            };

            // Simulación de almacenamiento local (no persistente)
            let registros = JSON.parse(localStorage.getItem('finalizado')) || [];
            registros.push(registro);
            localStorage.setItem('finalizado', JSON.stringify(registros));

            document.getElementById('formFinalizado').reset();
            document.getElementById('mensajeFinalizado').innerText = 'El registro se realizó exitosamente.';
            mostrarRegistros();
            setTimeout(() => {
                document.getElementById('mensajeFinalizado').innerText = '';
                document.getElementById('registroFinalizado').classList.remove('active');
            }, 3000);
        }

        function cancelarRegistro(opcion) {
            if (opcion === 'entrega') {
                document.getElementById('registroEntrega').classList.remove('active');
            } else if (opcion === 'finalizado') {
                document.getElementById('registroFinalizado').classList.remove('active');
            }
        }

        function mostrarRegistros() {
            let entregaRegistros = JSON.parse(localStorage.getItem('entrega')) || [];
            let finalizadoRegistros = JSON.parse(localStorage.getItem('finalizado')) || [];

            let listaHTML = '';
            entregaRegistros.forEach(registro => {
                listaHTML += `<div class="registro entrega">
                                <p><strong>Nombre:</strong> ${registro.nombre}</p>
                                <p><strong>GDL:</strong> ${registro.pedido}</p>
                                <p><strong>Fecha y Hora de Impresión:</strong> ${registro.fechaHoraImpresion}</p>
                                <p><strong>Fecha del Registro:</strong> ${registro.fechaRegistro}</p>
                                <p><strong>Tiempo Total:</strong> ${registro.tiempoTotal}</p>
                             </div>`;
            });

            finalizadoRegistros.forEach(registro => {
                listaHTML += `<div class="registro finalizado">
                                <p><strong>Nombre:</strong> ${registro.nombre}</p>
                                <p><strong>GDL:</strong> ${registro.pedido}</p>
                                <p><strong>Fecha y Hora de Inicio de Empaque:</strong> ${registro.fechaHoraInicioEmpaque}</p>
                                <p><strong>Fecha del Registro:</strong> ${registro.fechaRegistro}</p>
                                <p><strong>Tiempo Total:</strong> ${registro.tiempoTotal}</p>
                                <p><strong>Estatus:</strong> ${registro.estatus}</p>
                                <p><strong>Observaciones:</strong> ${registro.observaciones}</p>
                             </div>`;
            });

            document.getElementById('listaRegistros').innerHTML = listaHTML;
            document.getElementById('registros').classList.add('active');
        }

        function filtrarPorFecha() {
            const fechaFiltro = document.getElementById('fechaFiltro').value;
            if (!fechaFiltro) return;

            let entregaRegistros = JSON.parse(localStorage.getItem('entrega')) || [];
            let finalizadoRegistros = JSON.parse(localStorage.getItem('finalizado')) || [];

            entregaRegistros = entregaRegistros.filter(registro => {
                return registro.fechaRegistro.startsWith(fechaFiltro);
            });

            finalizadoRegistros = finalizadoRegistros.filter(registro => {
                return registro.fechaRegistro.startsWith(fechaFiltro);
            });

            let listaHTML = '';
            entregaRegistros.forEach(registro => {
                listaHTML += `<div class="registro entrega">
                                <p><strong>Nombre:</strong> ${registro.nombre}</p>
                                <p><strong>GDL:</strong> ${registro.pedido}</p>
                                <p><strong>Fecha y Hora de Impresión:</strong> ${registro.fechaHoraImpresion}</p>
                                <p><strong>Fecha del Registro:</strong> ${registro.fechaRegistro}</p>
                                <p><strong>Tiempo Total:</strong> ${registro.tiempoTotal}</p>
                             </div>`;
            });

            finalizadoRegistros.forEach(registro => {
                listaHTML += `<div class="registro finalizado">
                                <p><strong>Nombre:</strong> ${registro.nombre}</p>
                                <p><strong>GDL:</strong> ${registro.pedido}</p>
                                <p><strong>Fecha y Hora de Inicio de Empaque:</strong> ${registro.fechaHoraInicioEmpaque}</p>
                                <p><strong>Fecha del Registro:</strong> ${registro.fechaRegistro}</p>
                                <p><strong>Tiempo Total:</strong> ${registro.tiempoTotal}</p>
                                <p><strong>Estatus:</strong> ${registro.estatus}</p>
                                <p><strong>Observaciones:</strong> ${registro.observaciones}</p>
                             </div>`;
            });

            document.getElementById('listaRegistros').innerHTML = listaHTML;
        }

        function calcularTiempoTotal(fechaInicio, fechaFin) {
            const diff = fechaFin - fechaInicio;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            return `${hours} horas y ${minutes} minutos`;
        }

        function formatDateTime(date) {
            const options = { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                hour12: true 
            };
            return new Intl.DateTimeFormat('es-ES', options).format(date);
        }

        function exportarRegistros() {
            let entregaRegistros = JSON.parse(localStorage.getItem('entrega')) || [];
            let finalizadoRegistros = JSON.parse(localStorage.getItem('finalizado')) || [];

            let entregaData = entregaRegistros.map(registro => ({
                Nombre: registro.nombre,
                'GDL': registro.pedido,
                'Fecha y Hora de Impresión': registro.fechaHoraImpresion,
                'Fecha del Registro': registro.fechaRegistro,
                'Tiempo Total': registro.tiempoTotal
            }));

            let finalizadoData = finalizadoRegistros.map(registro => ({
                Nombre: registro.nombre,
                'GDL': registro.pedido,
                'Fecha y Hora de Inicio de Empaque': registro.fechaHoraInicioEmpaque,
                'Fecha del Registro': registro.fechaRegistro,
                'Tiempo Total': registro.tiempoTotal,
                Estatus: registro.estatus,
                Observaciones: registro.observaciones
            }));

            let wb = XLSX.utils.book_new();

            let wsEntrega = XLSX.utils.json_to_sheet(entregaData);
            XLSX.utils.book_append_sheet(wb, wsEntrega, 'Registros de Entrega');

            let wsFinalizado = XLSX.utils.json_to_sheet(finalizadoData);
            XLSX.utils.book_append_sheet(wb, wsFinalizado, 'Registros de Finalizado');

            XLSX.writeFile(wb, 'registros.xlsx');
        }

        function volverAlPrincipal() {
            document.getElementById('registros').classList.remove('active');
        }

        function actualizarReloj() {
            const now = new Date();
            const horas = now.getHours() % 12 || 12;
            const minutos = String(now.getMinutes()).padStart(2, '0');
            const segundos = String(now.getSeconds()).padStart(2, '0');
            const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
            const tiempo = `${horas}:${minutos}:${segundos} ${ampm}`;
            document.getElementById('reloj').innerText = tiempo;
        }

        // Mostrar registros al cargar la página
        window.onload = function() {
            mostrarRegistros();
            setInterval(actualizarReloj, 1000);
        };
    </script>
</body>
</html>